# 跨链资产迁移协议

## 动机

当前的资产跨链方案都是基于锁定映射的模式，即用户将资产锁定在一边，然后在另一边映射资产。
然而 Bitcoin 上很难实现无托管锁定资产，再加上 Ordinals 协议的资产还依赖索引器进行有效性校验，这导致资产跨链方案变得复杂。

所以我们提出一种协议内的资产“迁移”方案，它不同于锁定映射的模式，而是在一边销毁资产，然后在另一边发行资产。这种方案的优势是：

1. 不会聚集大量的资产在桥中，避免了集中性风险，资产迁移模式的风险是分散的。
2. 资产从 Bitcoin 迁移到链下或者其他链，可以减少 Bitcoin 的 UTXO 数量，缓解状态爆炸问题。
3. 资产可以先在链下发行，然后迁移到 Bitcoin，这样可以降低 Bitcoin 资产的初始化发行成本。

理论上来说，Bitcoin 上的所有客户端验证（Client-side validation）资产协议都可以通过这种方式迁移到链下，但需要协议内的支持，我们先以 Bitseed 协议为例，介绍资产迁移的协议。

## 关键概念

**资产验证器(Asset Validator)**

RGB 以及 Ordinals 等协议都可以归为客户端验证资产协议，区别是完全由终端用户的钱包来验证，还是依赖索引器来验证，抑或混合验证。所以我们把钱包和索引器都统称为"资产验证器(Asset Validator)"，资产验证器实现了资产协议，可以验证资产的有效性。而可对外公开访问的资产验证器，我们可以称为“公共资产验证器”。

**资产仓库（Asset Repository)**

我们把给资产提供存储的平台统一抽象为"资产仓库"，它可以是一条链，或者非链的基础设施，但有个要求是资产仓库需要提供公开可验证接口，让资产验证器可以验证和追踪资产。

资产仓库需提供资产的存储以及保证所有权，而资产的有效性由资产验证器保证。资产迁移协议就是要实现资产在不同的资产仓库之间的迁移。

Bitcoin 在这既是资产类型的定义平台，也是一个资产仓库。不同的资产仓库的提供的安全性和功能不一样，用户将资产在不同的仓库间迁移，在应用场景和和安全性之间寻求平衡。

**资产类型映射（Asset Type mapping）**

不同的资产仓库，以及资产协议，对资产类型表达方式不一样，所以需要一种资产类型映射机制。

## Bitseed 资产迁移协议

### 资产迁移到支持资产验证器的资产仓库

如果资产仓库同时也是资产验证器，资产迁移协议就可以简化。而 [RoochNetwork](https://rooch.network) 本身通过智能合约实现了资产验证协议，也是 Bitcoin 的 Layer2 可以作为资产仓库，我们以一个例子来说明 Bitseed 资产如何迁移到 Rooch。假如用户 alice 要将一张 amount 为 1000 的 bits 从 Bitcoin 迁移到 Rooch 中的资产协议 RSFT。

1. Alice 将携带 1000 个 bits 的 UTXO 输出到 OP_RETRUN 中，然后备注上 `migrate_to Rooch` ，该资产在链上被销毁。
2. 该交易所在的区块同步到 Rooch 后，智能合约执行该交易，检测到它操作了 Bitseed 资产，会调用 `bitseed.move` 合约的 `migrate_from`, 该方法会在 Rooch 中销毁该张 bits 所在的 Inscription 对象，并自动铸造出一张名为 `bitseed.bits` 的 rsft，amount 为 1000。
3. 该 RSFT 在 Rooch 上被转移给了用户 Bob。Bob 想把 500 bits 资产迁移回 Bitcoin 上。
4. Bob 在 Rooch 上发起一个交易，调用 `bitseed.move` 合约的 `migrate_to` 方法，通过参数表明要迁移到 bitcoin。合约会自动生成一个 Bitcoin 的 Bitseed 操作交易，操作指令为 `migrate_from`，参数类似 mint 操作。同时记录该交易 ID 并锁定该 RSFT。
5. Bob 签名该交易，并提交到 Bitcoin 网络。
6. 等该交易上链，同步到 Rooch 后，Rooch 合约发现它是一个 `migrate_from rooch` 的交易，会和发起操作作比较，如果匹配，则标志该 Bitseed 为有效的资产。

**备注**
1. 这里的流程没有考虑 reorg 的问题。reorg 由 Rooch 的 bitcoin-move 框架统一处理。
2. 这里只考虑到用 SFT 来表达 FT 的场景，如果是 NFT，如何维系一个延续的业务 ID 是 bitseed 协议需要考虑的。
3. 需要补充客户端以及其他的资产验证器的逻辑。

### 资产迁移到其他链

资产迁移到其他链，其他链无法验证 Bitcoin 上的 Ordinals/Bitseed 协议，需要和资产验证器配合。

TODO

### 安全性分析

1. 用户的资产从 Bitcoin 迁移到资产仓库后，安全性由该资产仓库保证。
2. 资产仓库需要给第三方（钱包以及索引器）提供接口，验证资产的所有权。
3. 为了保证单个资产仓库的安全不影响整个网络，需要给每个资产仓库累积一个总额，确保如果单个资产仓库有风险，只影响该资产仓库的用户。
