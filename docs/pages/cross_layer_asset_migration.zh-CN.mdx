# 跨层资产迁移

当前的资产夸层或者跨链方案都是基于锁定映射的模式，即用户将资产锁定在一边，然后在另一边映射资产。然而 Bitcoin 上很难无托管锁定资产，再加上 Ordinals 协议的资产还依赖索引器进行合法性校验，这导致资产跨链或者跨层的方案变得复杂。

所以我们提出一种协议内的资产“迁移”方案，它不同于锁定映射的模式，而是在一边销毁资产，然后在另一边发行资产。这种方案的优势是：

1. 不会聚集大量的资产在桥中，避免了集中性风险，资产迁移模式的风险是分散的。
2. 资产从 Bitcoin 迁移到链下后，可以减少 Bitcoin 的 UTXO 数量，缓解状态爆炸问题。
3. 资产可以先在链下发行，然后迁移到 Bitcoin，这样可以降低资产的初始化发行成本。

理论上来说，Bitcoin 上的所有客户端验证（Client Side validation）资产协议都可以通过这种方式迁移到链下，但需要协议内的支持，我们先以 Bitseed 协议为例，介绍资产迁移的协议。

我们认为，RGB 以及 Ordinals 等协议都可以归为客户端验证资产协议，区别是完全由终端用户的钱包来验证，还是依赖索引器来验证，抑或混合验证。后面我们把钱包和索引器都统称为"资产验证器(Asset Validator)"，资产验证器实现了资产协议，可以验证资产的合法性。

## Bitseed 资产迁移协议

我们先分几个场景来分析资产迁移协议：

### 场景1: 链下初始化发行，迁移到 Bitcoin 上

这种场景 Bitseed 的 generator 模式已经支持，只需要设计一种特殊的 generator，它的输入参数是验证 Merkle tree 的 proof。链下发行平台只需要将发行完成后的链下资产生成 Merkle tree，
并将 Merkle tree 的根作为部署参数。用户可以自己的 proof 作为参数在 Bitcoin 上进行 mint。

待讨论问题：

1. 链下发行的时候，需要提前注册好资产的 tick 名称，避免被别人占用。Bitseed 协议需要提供一种 tick 名称预注册的机制。
2. 如果一部分用户的资产愿意迁移到链上，另外一部分用户依然想在链下使用，Merkle tree 的根如何更新。

### 场景2: Bitcoin 上的资产迁移到链下

已经在 Bitcoin 上发行的资产，要迁移到链下，需要销毁 Bitcoin 上的资产，然后在链下铸造。我们把链下的平台统一抽象为"资产仓库（AssetRepository）"，它可以是一条链，也可以是索引器，还可以是中心化交易所。

1. 用户 A 将携带 Bitseed 资产的 UTXO 输出到 OP_RETRUN 指令，然后备注上 `migrate_to $asset_repository_name` ，该资产在链上被销毁。我们用 R 来代替这里的资产仓库。
2. 资产仓库铸造迁移资产有两种方案：
    * 如果资产仓库本身是 Bitseed 的索引器，它需要监听 Bitcoin 上的交易，一旦发现有 OP_RETURN 的交易，并且备注上的 `asset_repository_name` 和自己匹配，则自动发行内部资产给对应的用户。
    * 如果资产仓库是另外一条链，用户需要在目标链上发起一个交易，携带 Bitcoin 上的资产迁移交易的证明，然后在目标链上用和 Bitseed 协议兼容的协议铸造资产。由于目标链本身无法验证 Bitcoin 上的 Bitseed 协议资产，所以需要 Bitseed 协议的索引器或者钱包来配合验证。
3. 用户 A 在资产仓库 R 中分拆，合并，转移给了用户 B。B 想把资产迁移回 Bitcoin 上。
4. 用户 B 在资产仓库 R 中发起提款请求，获取到资产证明，然后携带证明在 Bitcoin 上用 `migrate_from` 重新铸造资产。`migrate_from` 操作指令的操作参数类似于 `mint` 指令。
5. 钱包和索引器需要验证该资产证明，然后标志该资产为合法。

### 安全性分析

1. 用户的资产从 Bitcoin 迁移到资产仓库后，安全性由该资产仓库保证。
2. 资产仓库需要给第三方（钱包以及索引器）提供接口，验证资产的所有权。
3. 为了保证单个资产仓库的安全不影响整个网络，需要给每个资产仓库累积一个总额，确保如果单个资产仓库有风险，只影响该资产仓库的用户。
